# 2주차

## 보로노이 테셀레이션

### 구현 내용
- 3D 보로노이 셀을 생성, 시각화

### 구현 이유
- 비정형적인 분할 시각화

### 구현 세부사항
- **입자 기반 분할**  
  랜덤 입자 좌표를 기반으로 셀을 생성함(현재 균일 분포 생성)

- **경계 조건 설정**  
  주어진 모델을 완전히 포함하는 박스 형태로 경계를 설정하여 셀의 외곽을 제어함

- **최적화**  
  그리드 기반 입자 분할, 인접 그리드의 입자 계산후 탈락하는 파티클을 제거, 퍼포먼스 향상

- **셀 출력 시각화**  
  각 셀을 메쉬 형태로 변환하여 3D 씬에서 시각적으로 확인 가능함
>![img](https://github.com/sturdyChair/asset/blob/main/Cube%20Fracturing.PNG)


### TODO
- **디버깅 도구 추가**  
  -셀 ID, 부피, 중심좌표, 인접 셀 등을 표시하여 디버깅 및 개발 편의성 향상
  
---

## 메쉬 불리언 연산

### 구현 내용 
- 두 개의 메쉬 간의 교차, 합집합, 차집합을 직접 구현

### 구현 이유
- 보로노이 테셀레이션과 실제 메쉬를 교차, 원하는 모양의 메쉬 조각을 구하고 기존 정점의 정보를 보존

### 구현 세부사항
- **BSP 트리 기반 분할**  
  -메쉬를 절단면 기준으로 나누고, 재귀적으로 서브트리를 구성함
 
- **교차 엣지 처리**  
  -삼각형 간의 교차 엣지를 계산하고, 교차점에 정점을 새로 생성함

- **속성 보간**  
  -새로운 정점에 대해 노멀, 텍스처 좌표, 탄젠트를 선형 보간하여 품질 유지

- **중복 정점 제거**  
  -정점의 위치, 법선, UV좌표를 해쉬한 후 std::unordered_map을 이용해 중복 정점 제거, 기존 품질을 유지하며 10% ~ 50% 정도의 정점 제거

- **시각화**  
    불리언 연산 결과를 시각화
>![img](https://github.com/sturdyChair/asset/blob/main/Intersect.PNG) torus와 cube의 Intersect 연산 결과

### 트러블 슈팅
- **BSP 절단면 선택 기준**  
>![img](https://commons.apache.org/proper/commons-geometry/images/tutorials/bsp-tree/hex-unbalanced.svg)

  볼록 다면체의 경우 위와 같이 트리 불균형이 일어남  
  현재 메쉬 상의 랜덤 삼각형을 사용 (고정 인덱스 사용시에 비해 2배 정도 성능 향상)
  
- **단정밀도 오차**  
  메쉬 불리언 이후 메쉬가 찢어지는 현상 발견, float를 double로 변경 후 epsilon을 1e-8로 바꾸어 완화
  
- **삼각형 누락 버그**  
  BSP 트리 구성 중 삼각형이 누락되는 현상 발견, 삼각형 - 평면 절단 함수에 assert를 이용해 edge case 발견  
  평면이 삼각형의 정점을 지나가는 경우를 고려하지 못함(현재 수정됨)
  
- **중복 정점**  
  최초 구현시 정점 위치만을 이용해 중복 정점을 제거하고 나머지 정보들은 선형 평균함 -> 메쉬 품질 저하

- **병렬화**  
  디버그 빌드에서 메쉬 불리언 연산 병렬화 시 성능 저하 -> 빌드 방식에 따라 쓰레드 수 변경

### TODO
- BSP 트리 절단면 최적화
  랜덤 샘플된 메쉬상 삼각형 n개의 점수(폴리곤 분할, 트리 균형 등)를 비교해 최적 절단면 선택
- 메쉬 연결 확인
  정점을 위치에 따라 병합, 그래프 탐색을 통해 연결 확인 후 분할
- 테셀레이션 + 메쉬 불리언 시각화 & 시뮬레이트
  현재 메쉬 정보 구성 중






